"0","#Compute the b-spline basis matrix"
"0","y <- nir_mean_df$mean"
"0","x = seq(0,1000,length.out = length(y))"
"0","k <- 15"
"0","n <- length(y)"
"0",""
"0","# Different lambda selection"
"0","allspar = seq(0,1,length.out = 1000)"
"0","p = length(allspar)"
"0","RSS = rep(0,p)"
"0","df = rep(0,p)"
"0","for(i in 1:p)"
"0","{"
"0","  yhat = smooth.spline(nir_mean_df, df = k+1, spar = allspar[i])"
"0","  df[i] = yhat$df"
"0","  yhat = yhat$y"
"0","  RSS[i] = sum((yhat-y)^2)"
"0","}"
"0","# GCV criterion "
"0","GCV = (RSS/n)/((1-df/n)^2)"
"0","par(mfrow=c(1,2))"
"0","plot(allspar,GCV,type = ""l"", lwd = 3)"
